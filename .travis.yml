language: php
php:
  - '7.0'

git:
  depth: false

services:
  - docker

sudo: required

env:
  - DOCKER_COMPOSE_VERSION=1.24
  - DOMAIN=mirrors-photo.local
  - NGINX_PORT_EXTERNAL=420
  - WEBSOCKET_PORT_EXTERNAL=8000
  - DATABASE_HOST=postgresql
  - DATABASE_USERNAME=mirrors
  - DATABASE_PASSWORD=devpass
  - DATABASE_NAME=mirrors
  - DATABASE_PORT_INTERNAL=5432
  - DATABASE_PORT_EXTERNAL=2517
  - JWT_KEY=devkey

install:
  - docker-compose up -d --build
  - docker exec -it mirrors_php_1 php composer.phar install
  - docker exec -it mirrors_php_1 vendor/bin/phinx migrate

script:
  - docker exec -it mirrors_behat_1 vendor/bin/behat

after_script:
  - docker-compose stop
  - docker-compose rm -f
