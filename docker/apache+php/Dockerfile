FROM nimmis/alpine-apache-php7
####################################################################################################################APK
RUN set -xe && \
    apk update && apk upgrade && \
    apk add nano mc && \
    apk add php7-pcntl php7-posix php7-ctype php7-pdo_pgsql
####################################################################################################################
####################################################################################################################Run srtipts
ADD scripts/* /etc/run_always/

RUN chmod +x /etc/run_always/*
####################################################################################################################
####################################################################################################################Services
ADD services/socket.sh /etc/service/socket/run

RUN chmod +x /etc/service/socket/run
####################################################################################################################
####################################################################################################################Install Phalcon
# http://packages.nanobox.io/2017/11/base/index.html
ADD phalcon.so /usr/lib/php7/modules/phalcon.so
RUN echo "extension=phalcon.so" > /etc/php7/conf.d/50-phalcon.ini
####################################################################################################################
####################################################################################################################Enable rewrite module
ADD conf/enable_mod_rewrite.conf /web/config/conf.d/enable_mod_rewrite.conf
####################################################################################################################
####################################################################################################################Virtual hosts
ADD conf/virtual_hosts/api.conf /web/config/conf.d/api.conf
ADD conf/virtual_hosts/static.conf /web/config/conf.d/static.conf